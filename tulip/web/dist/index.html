<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"> 
    <link rel="stylesheet" href="xterm.css" />
    <script type="text/javascript" src="xterm.js"></script>
    <script src="micropython.mjs" type="module"></script>
    <script type="text/javascript" src="enable-threads.js"></script>
    <script type="text/javascript" src="amy.js"></script>
    <script type="text/javascript" src="spss.js"></script>
  </head>
  <body>
    <script type="module">
      // Tulip settings
      term = new Terminal({rows:40, cols:100, fontSize:12, theme: { background: '#004955'  }});

      //term.writeln("Tap in the terminal window here to start...");
      term.open(document.getElementById('terminal'));
      const stdoutWriter = (line) => {
        // While it's called line, it's always one char, line[0].
        // Writing a 10 to xterm does LF but not CR, so we use its writeln to LFCR
        if(line[0]==10) {
          term.writeln([0]);
        } else {
          term.write(line);
        }
      };

      // Tulip settings
      mp = await loadMicroPython({
        stdout:stdoutWriter, 
        linebuffer: false,
        pystack: 32 * 1024, 
        heapsize: 2 * 1024 * 1024
      });
      term.onKey(e => {
        var code = e.key.charCodeAt(0);
        mp.replProcessCharWithAsyncify(code).then((response) => {
        });
      });
      await term.clear();
      // Tell MP to start serving a REPL
      await mp.replInit();
      
    </script>
    <div class="container-fluid px-5 my-5">
      <h1><A HREF="https://github.com/shorepine/tulipcc">Tulip</A> Web</h1>

      <!-- Tulip's SDL canvas -->
      <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>

      <div id="terminal"></div>
      <script language="javascript">        
        // On click anywhere, start audio
        document.body.addEventListener('click', start_audio, true); 
      </script>
    </div>

  </body>
</html>


